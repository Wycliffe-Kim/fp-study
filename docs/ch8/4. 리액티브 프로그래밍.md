# 리액티브 프로그래밍

이러한 비동기 처리의 문제를 적절하게 해결하는 방법 중에 두 번째 방법은 리액티브 프로그래밍을 하는 것이다.

리액티브 프로그래밍은 `Promise` 기반의 예제와 비슷한 방식으로 동작하지만 더 높은 수준의 추상화를 제공하며 더 강력한 연산을 제공한다.

우선 이를 위해서는 Observable의 개념을 먼저 알아야 한다.

Observable은 모든 구독 가능한 객체를 가리킨다. 리액티브 프로그래밍은 모든 데이터 제공원을 Observable을 통해 일원화 하여 구독할 수 있다.

Observable을 사용하는 방법은 다음과 같다.

``` javascript
// javascript
const _ = require('lodash');
const { Observable } = require('rxjs');

const observable = new Observable((subscriber) => {
  _.range(1, 10).forEach((i) => subscriber.next(i));
  subscriber.complete();
});

observable.subscribe({
  next(x) { console.log('next', x); },
  complete() { console.log('complete'); }
});
```

``` python
# python
import rx 
# python에서도 javascript와 동일하게 rxpy라는 라이브러리를 제공한다.
# rxpy에서는 Observable을 create 함수를 통해 생성한다.

def observable_func(observer, scheduler):
    pydash.for_each(range(1, 10), lambda i: observer.on_next(i))
    observer.on_completed()
    
observable = rx.create(observable_func)
observable.subscribe(
    on_next= lambda x: print('next', x),
    on_completed= lambda: print('complete'),
)
```

또한 Observable은 기존에 사용했던 `Promise`와도 연동할 수 있다.

``` javascript
// javscript
const { from } = require('rxjs');
const { map, filter } = require('rxjs/operators');

from(getJSONPromise('http://localhost:5555/students'))
.pipe(
  map(R.map((student) => student.grade)),
  map(average),
)
.subscribe({
  next(student) { console.log(student) },
  error(err) { console.log(err) }
});
```

``` python
# python
from rx.operators import map, filter
import rx
from promise import Promise

def from_promise(promise: Promise):
    return rx.create(
        lambda observer, scheduler: 
            observer.on_next(promise.value) 
            if promise.is_fulfilled else 
            observer.on_error(promise.value)
    )

_map = pydash.curry(lambda func, arr: pydash.map_(arr, func))
    
(from_promise(get_json_promise('http://localhost:5555/students'))
.pipe(
   map(_map(lambda student: student['grade'])),
   map(average)
)
.subscribe(
   on_next= lambda student: print(student),
   on_error= lambda err: print(err)
))
```

위의 예제 코드를 보면 알 수 있다시피 Observable로 구독된 객체 혹은 Promise는 `pipe` 함수를 통해서 합성이 가능하다. `pipe`는 앞서 4부에서 살펴보았던 `pipe`와 동일하게 앞에서 뒤로 합성한다.